SPX Trade Dashboard — Project Notes
=====================================

OVERVIEW
--------
macOS app + web dashboard for stock trading tools (SPX/stocks).
Opens all trading tools in one click and displays a live dashboard
that pulls data from the Google Sheet Trade Tracker.

FILES
-----
SPX/index.html
  - Single-file HTML dashboard (dark trading theme)
  - Fetches live data from Apps Script doGet(?action=dashboard)
  - Auto-refreshes every 60 seconds
  - Sections: Quick Stats, Action Needed, Ticker Grid, Recent Signals, Performance

RSI_Trendline_Buy (Stocks)/trade_tracker/apps_script.gs
  - Modified: added ?action=dashboard JSON endpoint to doGet()
  - Returns: tickers, recentSignals, actionNeeded, stats
  - No auth needed — same public web app URL

/Applications/SPX Trade.app
  - macOS app bundle (same structure as Trade.app for crypto)
  - Opens Chrome fullscreen with 3 tabs:
    1. Dashboard (file://...SPX/index.html)
    2. TradingView (stock charts)
    3. Google Sheet (Trade Tracker)

DEPLOYMENT — Apps Script
------------------------
1. Open Google Sheet → Extensions → Apps Script
2. Replace code with contents of apps_script.gs
3. Deploy → Manage deployments → Edit → New version → Deploy
4. Test: visit deployed URL with ?action=dashboard appended
   Should return JSON with tickers, stats, etc.

DEPLOYMENT — macOS App
----------------------
Already installed at /Applications/SPX Trade.app
Double-click to launch. If Chrome tabs don't open:
  - Check that Google Chrome is installed
  - The launcher script is at SPX Trade.app/Contents/MacOS/launcher

DASHBOARD DATA FLOW
--------------------
TradingView Alert → webhook POST → doPost() → Signal Log + Positions
User marks Action/Outcome in Positions → Dashboard tab formulas update
Dashboard HTML → fetch doGet(?action=dashboard) → renders all tabs as JSON

CUSTOMIZATION
-------------
- Dashboard theme: edit CSS in index.html (currently dark trading theme)
- Refresh interval: change REFRESH_INTERVAL in index.html <script> (default 60s)
- TradingView chart URL: edit launcher script in app bundle
- Google Sheet URL: edit launcher script in app bundle

API ENDPOINT
------------
URL: https://script.google.com/macros/s/AKfycbwVwBpJsq5kybfAuo8DpvODludwPehRWeT81bRe1PftdSuYCXv90FnewvIsZtCZIUv6Cg/exec
  ?action=dashboard          → returns JSON dashboard data (includes badge grades + effective sizes)
  ?action=tasks              → returns weekly tasks from "Weekly Tasks" tab
  ?action=add_portfolio&amount=300 → allocates paycheck to Grade 3+ buy-side tickers
  (no params)                → returns health check JSON
  POST with JSON             → logs trade signal

WEBSITE-ONLY FEATURES (Feb 9, 2026)
------------------------------------
Hidden on mobile via @media (max-width: 900px)

Weekly Tasks:
  - Google Sheet "Weekly Tasks" tab, Column A = tasks
  - Served via ?action=tasks endpoint
  - localStorage key: spx_weekly_todos_YYYY-MM-DD (resets each Monday)
  - Section appears between quote banner and stats bar
  - Hides when all tasks checked

4 Day Check (Open Trades):
  - 96h timer auto-starts when trade first appears
  - Shows days: 4d, 3d, 2d, 1d — then hours: 23h, 22h... for last day
  - Red "CHECK!" with glow after 4 days, click resets timer
  - "Need 4 Day" filter button flashes red with count
  - localStorage key: spx_4day_checks

Other Changes:
  - Open trades only show AFTER clicking "Entered" (filters pending action-needed)
  - OxO/TP badge positioned on right side of card
  - BUY/OxO tags made smaller (0.4rem, opacity 0.7) to reduce clutter
  - Service worker v29: network-first for HTML (prevents stale cache)
  - ALWAYS bump service-worker.js cache version when pushing changes

Updates (Feb 9, 2026 — session 2):
  - Won button now immediately closes trade as TP Hit (no more partial/CLOSE flow)
  - All dashboard writes use GET (not POST) — POST silently fails due to CORS redirects
  - Apps Script doGet handles ?action=update_position with query params
  - Fixed updatePosition_ matching: outcome updates find rows where Action=Entered (was looking for empty Action)
  - Fixed sumLockedBySide_: only sums profitLocked from TP Hit trades (was including stopped out losses)
  - Performance summary: glow effects on profit/loss values, streaks show "Win"/"Loss" not "W"/"L"

BADGE SYSTEM — Ticker Trust (Feb 10, 2026)
-------------------------------------------
10 badge grades, per-side (buy/sell calculated independently):

  Grade  Badge        Wins  Max Stop Rate  Multiplier  Alloc Weight
  1      Boulder      0     —              1.0x        0
  2      Cascade      1     —              1.0x        0
  3      Thunder      2     —              1.0x        5
  4      Rainbow      3     —              1.3x        10
  5      Soul         4     <30%           1.5x        15
  6      Marsh        6     <25%           1.7x        20
  7      Volcano      8     <25%           2.0x        25
  8      Earth        10    <20%           2.3x        30
  9      Elite Four   15    <20%           2.5x        35
  10     Master       20    <15%           3.0x        40

How it works:
  - calcBadgeGrade_(rows, side) counts wins/losses per side
  - Finds highest grade where wins >= requirement AND stop rate < max
  - Demotion: 2 consecutive stops = -1 grade, 3+ = -2 grades
  - Effective Size = Next Size (from phase logic) × Badge Multiplier

Dashboard JSON now includes per-ticker:
  buyBadge, sellBadge (grade/name/multiplier/wins/losses/stopRate)
  buyEffectiveSize, sellEffectiveSize

Ticker cards show: badge icon (20px) next to name, badge name + multiplier in detail grid,
"Effective Size" replaces "Next Size". Action needed cards show "Enter at $X" with pre-filled size.

Badge images: SPX/badges/ (Boulder_Badge.png through master-ball.png)
  - master-ball.png used for both Elite Four (9) and Master (10)

PAYCHECK ALLOCATOR (Feb 10, 2026)
----------------------------------
"+ Portfolio" button in header → modal with amount input + preview table.
Allocates to buy-side Grade 3+ tickers only. Grade 1-2 shown grayed as "Unproven".

Diminishing returns formula:
  absorb_rate = 1000 / (1000 + currentBase)
  effective_weight = badge_weight × absorb_rate
  allocation = amount × (effective_weight / sum_of_all_effective_weights)

No hard ceiling — allocations asymptotically approach zero for high-base tickers.
Excess naturally flows to lower-base tickers with room to grow.

Examples at $100 paycheck:
  Base $0     → absorbs ~100%
  Base $1,000 → absorbs ~50%
  Base $5,000 → absorbs ~17%
  Base $10,000 → absorbs ~9%

Service worker: v34
