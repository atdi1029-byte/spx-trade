<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SPX Pokemon Scaling Guide</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Space Mono', monospace;
            background: #12100e;
            color: #d4c8b0;
            padding: 2rem 3rem;
            max-width: 960px;
            margin: 0 auto;
        }
        h1 {
            color: #e8a04c;
            font-size: 2rem;
            text-align: center;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 20px rgba(232,160,76,0.5);
        }
        .subtitle {
            text-align: center;
            color: #8a7e6a;
            font-size: 0.7rem;
            margin-bottom: 1.5rem;
            letter-spacing: 2px;
        }

        /* Level Finder */
        .level-finder {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 0.8rem 1.2rem;
            background: #1a1815;
            border: 1px solid #3a3530;
            border-radius: 8px;
        }
        .level-finder label {
            color: #8a7e6a;
            font-size: 0.7rem;
            letter-spacing: 1px;
        }
        .level-finder input {
            background: #12100e;
            border: 1px solid #3a3530;
            color: #e8a04c;
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            font-weight: 700;
            padding: 0.3rem 0.6rem;
            width: 100px;
            border-radius: 4px;
            outline: none;
        }
        .level-finder input:focus { border-color: #e8a04c; }
        .level-finder .finder-result {
            font-size: 0.7rem;
            color: #6aaa5a;
            min-width: 200px;
        }
        .finder-result img {
            width: 32px; height: 32px;
            image-rendering: pixelated;
            vertical-align: middle;
            margin-right: 0.3rem;
        }

        /* Progress Bar */
        .progress-bar {
            height: 6px;
            background: #1a1815;
            border-radius: 3px;
            margin-bottom: 2rem;
            overflow: hidden;
            border: 1px solid #3a3530;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6aaa5a, #e8a04c);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* Phases */
        .phase { margin-bottom: 0.5rem; }
        .phase-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 0.8rem 1rem;
            border-bottom: 1px solid #3a3530;
            user-select: none;
            position: relative;
            z-index: 1;
            border-radius: 4px;
            overflow: hidden;
        }
        .phase-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: var(--bg-url);
            background-size: cover;
            background-position: center;
            image-rendering: pixelated;
            z-index: -2;
            opacity: 0.9;
        }
        .phase-header::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(90deg, rgba(18,16,14,0.6), rgba(18,16,14,0.75));
            z-index: -1;
        }
        .phase-header:hover::after {
            background: linear-gradient(90deg, rgba(18,16,14,0.5), rgba(18,16,14,0.65));
        }
        .phase-title {
            font-size: 0.8rem;
            color: #e8a04c;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-shadow: 0 1px 4px rgba(0,0,0,0.8);
        }
        .phase-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .phase-count {
            font-size: 0.55rem;
            color: #d4c8b0;
            letter-spacing: 1px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
        }
        .phase-toggle {
            font-size: 0.7rem;
            color: #d4c8b0;
            transition: transform 0.2s;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
        }
        .phase.collapsed .phase-toggle { transform: rotate(-90deg); }
        .phase-body {
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .phase.collapsed .phase-body {
            max-height: 0 !important;
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.5rem 0 1rem;
        }
        th {
            text-align: left;
            font-size: 0.55rem;
            color: #8a7e6a;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 0.4rem 0.6rem;
            border-bottom: 1px solid #3a3530;
        }
        td {
            padding: 0.4rem 0.6rem;
            border-bottom: 1px solid #1a1815;
            font-size: 0.72rem;
        }
        tr:hover { background: #1a1815; }
        tr.highlight {
            background: rgba(232,160,76,0.12) !important;
            box-shadow: inset 0 0 0 1px rgba(232,160,76,0.3);
        }
        tr.highlight td { border-bottom-color: rgba(232,160,76,0.2); }
        .pokemon-name { color: #f0e6cc; font-weight: 700; }
        .evo-line { color: #8a7e6a; font-size: 0.55rem; }
        .profit { color: #6aaa5a; }
        .base { color: #e8a04c; font-weight: 700; }
        .gap { color: #8a7e6a; font-size: 0.6rem; }
        .lv { color: #8a7e6a; font-size: 0.65rem; }
        .sprite { width: 48px; height: 48px; image-rendering: pixelated; vertical-align: middle; }

        /* Notes */
        .notes {
            margin-top: 2rem;
            padding: 1rem 1.5rem;
            background: #1a1815;
            border: 1px solid #3a3530;
            border-radius: 8px;
            font-size: 0.65rem;
            line-height: 1.8;
            color: #8a7e6a;
        }
        .notes h3 {
            color: #e8a04c;
            font-size: 0.7rem;
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }
        .notes strong { color: #d4c8b0; }

        /* Expand / Collapse All */
        .controls {
            display: flex;
            justify-content: flex-end;
            gap: 0.8rem;
            margin-bottom: 1rem;
        }
        .controls button {
            background: none;
            border: 1px solid #3a3530;
            color: #8a7e6a;
            font-family: 'Space Mono', monospace;
            font-size: 0.55rem;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            letter-spacing: 1px;
        }
        .controls button:hover { border-color: #e8a04c; color: #e8a04c; }

        @media print {
            body { background: white; color: #222; }
            .phase-title { color: #b8602a; border-color: #ccc; }
            h1 { color: #b8602a; text-shadow: none; }
            .subtitle, .level-finder, .controls, .progress-bar { display: none; }
            th { color: #666; border-color: #ccc; }
            td { border-color: #eee; }
            .pokemon-name { color: #222; }
            .profit { color: #2a7a2a; }
            .base { color: #b8602a; }
            .gap, .evo-line, .lv { color: #888; }
            .notes { background: #f5f5f5; border-color: #ddd; }
            .notes h3 { color: #b8602a; }
            .notes strong { color: #222; }
            tr:hover { background: transparent; }
            .phase.collapsed .phase-body { max-height: none !important; }
        }
    </style>
</head>
<body>

<h1>Pokemon Scaling Guide</h1>
<div class="subtitle">SPX Trade Dashboard — Position Sizing by Profit Level — 151 Levels</div>

<div class="level-finder">
    <label>YOUR P&L: $</label>
    <input type="number" id="pnl-input" placeholder="0" min="0" step="1">
    <span class="finder-result" id="finder-result"></span>
</div>
<div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>

<div class="controls">
    <button onclick="expandAll()">EXPAND ALL</button>
    <button onclick="collapseAll()">COLLAPSE ALL</button>
</div>

<div id="guide"></div>

<div class="notes">
    <h3>How It Works</h3>
    <p><strong>151 levels</strong> = every Gen 1 Pokemon, from Bulbasaur ($0) to Mew ($30,000).</p>
    <p><strong>Your level</strong> = based on your total portfolio P&L across all tickers.</p>
    <p><strong>Evolution triggers</strong> = when your total P&L crosses a threshold, you level up.</p>
    <p><strong>Drawdown</strong> = if P&L drops below a level, your Pokemon goes back down to match.</p>
    <p><strong>Sizing</strong> = handled per-ticker by the Trust Grade system (see below), not by Pokemon level.</p>
    <p style="margin-top:0.8rem;color:#e8a04c"><strong>After Mew ($30k)</strong> — Gen 2 begins! Chikorita and beyond.</p>
</div>

<div class="notes" style="margin-top:1rem;">
    <h3>Ticker Trust System — Gym Badges</h3>
    <p style="margin-bottom:0.6rem;">Each ticker earns gym badges based on trade history. More badges = DCA unlocked + bigger sizing.</p>
    <table style="width:100%;margin:0.5rem 0;">
        <thead>
            <tr>
                <th style="font-size:0.5rem;">Grade</th>
                <th style="font-size:0.5rem;">Badge</th>
                <th style="font-size:0.5rem;">Gym Leader</th>
                <th style="font-size:0.5rem;">Multiplier</th>
                <th style="font-size:0.5rem;">DCA</th>
                <th style="font-size:0.5rem;">How to Earn</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="lv">1</td>
                <td><img src="https://archives.bulbagarden.net/media/upload/d/dd/Boulder_Badge.png" style="width:20px;height:20px;vertical-align:middle;image-rendering:pixelated;"> <span style="color:#a0a0a0;">Boulder</span></td>
                <td class="evo-line">Brock</td>
                <td class="base">1.0x</td>
                <td style="color:#c44b3f;font-size:0.6rem;">No DCA</td>
                <td class="evo-line">First signal — unproven</td>
            </tr>
            <tr>
                <td class="lv">2</td>
                <td><img src="https://archives.bulbagarden.net/media/upload/9/9c/Cascade_Badge.png" style="width:20px;height:20px;vertical-align:middle;image-rendering:pixelated;"> <span style="color:#5b9bd5;">Cascade</span></td>
                <td class="evo-line">Misty</td>
                <td class="base">1.0x</td>
                <td style="color:#c44b3f;font-size:0.6rem;">No DCA</td>
                <td class="evo-line">1 win (TP Hit)</td>
            </tr>
            <tr>
                <td class="lv">3</td>
                <td><img src="https://archives.bulbagarden.net/media/upload/a/a6/Thunder_Badge.png" style="width:20px;height:20px;vertical-align:middle;image-rendering:pixelated;"> <span style="color:#f0c040;">Thunder</span></td>
                <td class="evo-line">Lt. Surge</td>
                <td class="base">1.0x</td>
                <td style="color:#6aaa5a;font-size:0.6rem;">1 DCA add</td>
                <td class="evo-line">2 wins</td>
            </tr>
            <tr>
                <td class="lv">4</td>
                <td><img src="https://archives.bulbagarden.net/media/upload/b/b5/Rainbow_Badge.png" style="width:20px;height:20px;vertical-align:middle;image-rendering:pixelated;"> <span style="color:#6aaa5a;">Rainbow</span></td>
                <td class="evo-line">Erika</td>
                <td class="base">1.3x</td>
                <td style="color:#6aaa5a;font-size:0.6rem;">1 DCA add</td>
                <td class="evo-line">3 wins</td>
            </tr>
            <tr>
                <td class="lv">5</td>
                <td><img src="https://archives.bulbagarden.net/media/upload/7/7d/Soul_Badge.png" style="width:20px;height:20px;vertical-align:middle;image-rendering:pixelated;"> <span style="color:#c060c0;">Soul</span></td>
                <td class="evo-line">Koga</td>
                <td class="base">1.5x</td>
                <td style="color:#6aaa5a;font-size:0.6rem;">2 DCA adds</td>
                <td class="evo-line">4 wins, &lt;30% stop rate</td>
            </tr>
            <tr>
                <td class="lv">6</td>
                <td><img src="https://archives.bulbagarden.net/media/upload/6/6b/Marsh_Badge.png" style="width:20px;height:20px;vertical-align:middle;image-rendering:pixelated;"> <span style="color:#e8a04c;">Marsh</span></td>
                <td class="evo-line">Sabrina</td>
                <td class="base">1.7x</td>
                <td style="color:#6aaa5a;font-size:0.6rem;">2 DCA adds</td>
                <td class="evo-line">6 wins, &lt;25% stop rate</td>
            </tr>
            <tr>
                <td class="lv">7</td>
                <td><img src="https://archives.bulbagarden.net/media/upload/1/12/Volcano_Badge.png" style="width:20px;height:20px;vertical-align:middle;image-rendering:pixelated;"> <span style="color:#e05545;">Volcano</span></td>
                <td class="evo-line">Blaine</td>
                <td class="base">2.0x</td>
                <td style="color:#6aaa5a;font-size:0.6rem;">3 DCA adds</td>
                <td class="evo-line">8 wins, &lt;25% stop rate</td>
            </tr>
            <tr>
                <td class="lv">8</td>
                <td><img src="https://archives.bulbagarden.net/media/upload/7/78/Earth_Badge.png" style="width:20px;height:20px;vertical-align:middle;image-rendering:pixelated;"> <span style="color:#6aaa5a;">Earth</span></td>
                <td class="evo-line">Giovanni</td>
                <td class="base">2.3x</td>
                <td style="color:#6aaa5a;font-size:0.6rem;">3 DCA adds</td>
                <td class="evo-line">10 wins, &lt;20% stop rate</td>
            </tr>
            <tr>
                <td class="lv">9</td>
                <td><img src="https://archives.bulbagarden.net/media/upload/0/07/Magikarp_Jump_Elite_Four_League_Badge.png" style="width:20px;height:20px;vertical-align:middle;image-rendering:pixelated;"> <span style="color:#9370db;font-weight:700;">Elite Four</span></td>
                <td class="evo-line">Lorelei, Bruno, Agatha, Lance</td>
                <td class="base">2.5x</td>
                <td style="color:#6aaa5a;font-size:0.6rem;">Unlimited</td>
                <td class="evo-line">15 wins, &lt;20% stop rate</td>
            </tr>
            <tr>
                <td class="lv">10</td>
                <td><img src="https://archives.bulbagarden.net/media/upload/a/a6/Bag_Master_Ball_SV_Sprite.png" style="width:20px;height:20px;vertical-align:middle;image-rendering:pixelated;"> <span style="color:#e8a04c;font-weight:700;text-shadow:0 0 8px rgba(232,160,76,0.5);">Pokemon Master</span></td>
                <td class="evo-line">Champion</td>
                <td class="base">3.0x</td>
                <td style="color:#6aaa5a;font-size:0.6rem;">Unlimited</td>
                <td class="evo-line">20 wins, &lt;15% stop rate</td>
            </tr>
        </tbody>
    </table>
    <p style="margin-top:0.6rem;"><strong>Effective size</strong> = Your base trade size × Ticker Multiplier from badge grade.</p>
    <p><strong>Example:</strong> $30 base × Grade 5 Soul Badge (1.5x) = <strong style="color:#e8a04c;">$45 per trade</strong> on that ticker.</p>
    <p><strong>Demotion:</strong> 2 consecutive stops = drop 1 badge. 3 consecutive stops = drop 2 badges.</p>
</div>

<script>
// ============================================================
// ALL 151 GEN 1 POKEMON
// [pokedex_id, name, type, evolves_from_id (null = first stage)]
// ============================================================
const POKEMON = [
    [1,'Bulbasaur','Grass',null],
    [2,'Ivysaur','Grass',1],
    [3,'Venusaur','Grass',2],
    [4,'Charmander','Fire',null],
    [5,'Charmeleon','Fire',4],
    [6,'Charizard','Fire',5],
    [7,'Squirtle','Water',null],
    [8,'Wartortle','Water',7],
    [9,'Blastoise','Water',8],
    [10,'Caterpie','Bug',null],
    [11,'Metapod','Bug',10],
    [12,'Butterfree','Bug',11],
    [13,'Weedle','Bug',null],
    [14,'Kakuna','Bug',13],
    [15,'Beedrill','Bug',14],
    [16,'Pidgey','Normal',null],
    [17,'Pidgeotto','Normal',16],
    [18,'Pidgeot','Normal',17],
    [19,'Rattata','Normal',null],
    [20,'Raticate','Normal',19],
    [21,'Spearow','Normal',null],
    [22,'Fearow','Normal',21],
    [23,'Ekans','Poison',null],
    [24,'Arbok','Poison',23],
    [25,'Pikachu','Electric',null],
    [26,'Raichu','Electric',25],
    [27,'Sandshrew','Ground',null],
    [28,'Sandslash','Ground',27],
    [29,'Nidoran\u2640','Poison',null],
    [30,'Nidorina','Poison',29],
    [31,'Nidoqueen','Poison',30],
    [32,'Nidoran\u2642','Poison',null],
    [33,'Nidorino','Poison',32],
    [34,'Nidoking','Poison',33],
    [35,'Clefairy','Fairy',null],
    [36,'Clefable','Fairy',35],
    [37,'Vulpix','Fire',null],
    [38,'Ninetales','Fire',37],
    [39,'Jigglypuff','Normal',null],
    [40,'Wigglytuff','Normal',39],
    [41,'Zubat','Poison',null],
    [42,'Golbat','Poison',41],
    [43,'Oddish','Grass',null],
    [44,'Gloom','Grass',43],
    [45,'Vileplume','Grass',44],
    [46,'Paras','Bug',null],
    [47,'Parasect','Bug',46],
    [48,'Venonat','Bug',null],
    [49,'Venomoth','Bug',48],
    [50,'Diglett','Ground',null],
    [51,'Dugtrio','Ground',50],
    [52,'Meowth','Normal',null],
    [53,'Persian','Normal',52],
    [54,'Psyduck','Water',null],
    [55,'Golduck','Water',54],
    [56,'Mankey','Fighting',null],
    [57,'Primeape','Fighting',56],
    [58,'Growlithe','Fire',null],
    [59,'Arcanine','Fire',58],
    [60,'Poliwag','Water',null],
    [61,'Poliwhirl','Water',60],
    [62,'Poliwrath','Water',61],
    [63,'Abra','Psychic',null],
    [64,'Kadabra','Psychic',63],
    [65,'Alakazam','Psychic',64],
    [66,'Machop','Fighting',null],
    [67,'Machoke','Fighting',66],
    [68,'Machamp','Fighting',67],
    [69,'Bellsprout','Grass',null],
    [70,'Weepinbell','Grass',69],
    [71,'Victreebel','Grass',70],
    [72,'Tentacool','Water',null],
    [73,'Tentacruel','Water',72],
    [74,'Geodude','Rock',null],
    [75,'Graveler','Rock',74],
    [76,'Golem','Rock',75],
    [77,'Ponyta','Fire',null],
    [78,'Rapidash','Fire',77],
    [79,'Slowpoke','Water',null],
    [80,'Slowbro','Water',79],
    [81,'Magnemite','Electric',null],
    [82,'Magneton','Electric',81],
    [83,"Farfetch\u2019d",'Normal',null],
    [84,'Doduo','Normal',null],
    [85,'Dodrio','Normal',84],
    [86,'Seel','Water',null],
    [87,'Dewgong','Water',86],
    [88,'Grimer','Poison',null],
    [89,'Muk','Poison',88],
    [90,'Shellder','Water',null],
    [91,'Cloyster','Water',90],
    [92,'Gastly','Ghost',null],
    [93,'Haunter','Ghost',92],
    [94,'Gengar','Ghost',93],
    [95,'Onix','Rock',null],
    [96,'Drowzee','Psychic',null],
    [97,'Hypno','Psychic',96],
    [98,'Krabby','Water',null],
    [99,'Kingler','Water',98],
    [100,'Voltorb','Electric',null],
    [101,'Electrode','Electric',100],
    [102,'Exeggcute','Grass',null],
    [103,'Exeggutor','Grass',102],
    [104,'Cubone','Ground',null],
    [105,'Marowak','Ground',104],
    [106,'Hitmonlee','Fighting',null],
    [107,'Hitmonchan','Fighting',null],
    [108,'Lickitung','Normal',null],
    [109,'Koffing','Poison',null],
    [110,'Weezing','Poison',109],
    [111,'Rhyhorn','Ground',null],
    [112,'Rhydon','Ground',111],
    [113,'Chansey','Normal',null],
    [114,'Tangela','Grass',null],
    [115,'Kangaskhan','Normal',null],
    [116,'Horsea','Water',null],
    [117,'Seadra','Water',116],
    [118,'Goldeen','Water',null],
    [119,'Seaking','Water',118],
    [120,'Staryu','Water',null],
    [121,'Starmie','Water',120],
    [122,'Mr. Mime','Psychic',null],
    [123,'Scyther','Bug',null],
    [124,'Jynx','Ice',null],
    [125,'Electabuzz','Electric',null],
    [126,'Magmar','Fire',null],
    [127,'Pinsir','Bug',null],
    [128,'Tauros','Normal',null],
    [129,'Magikarp','Water',null],
    [130,'Gyarados','Water',129],
    [131,'Lapras','Water',null],
    [132,'Ditto','Normal',null],
    [133,'Eevee','Normal',null],
    [134,'Vaporeon','Water',133],
    [135,'Jolteon','Electric',133],
    [136,'Flareon','Fire',133],
    [137,'Porygon','Normal',null],
    [138,'Omanyte','Rock',null],
    [139,'Omastar','Rock',138],
    [140,'Kabuto','Rock',null],
    [141,'Kabutops','Rock',140],
    [142,'Aerodactyl','Rock',null],
    [143,'Snorlax','Normal',null],
    [144,'Articuno','Ice',null],
    [145,'Zapdos','Electric',null],
    [146,'Moltres','Fire',null],
    [147,'Dratini','Dragon',null],
    [148,'Dragonair','Dragon',147],
    [149,'Dragonite','Dragon',148],
    [150,'Mewtwo','Psychic',null],
    [151,'Mew','Psychic',null]
];

const STARTERS = new Set([1, 4, 7]);
const LEGENDARIES = new Set([144, 145, 146, 150]);
const MYTHICAL = new Set([151]);

// Build name lookup
const NAME_BY_ID = {};
POKEMON.forEach(p => NAME_BY_ID[p[0]] = p[1]);

// Evolution label
function evoLabel(id, name, type, evoFrom) {
    if (MYTHICAL.has(id)) return 'Mythical \u2014 Gen 1 Complete';
    if (LEGENDARIES.has(id)) return 'Legendary';
    if (STARTERS.has(id)) return type + ' Starter';
    if (evoFrom) return NAME_BY_ID[evoFrom] + ' evolves';
    return type;
}

// ============================================================
// SCALING MATH
// Profit: $0 to $30,000 over 151 levels (power curve, Mew = $30k)
// Base:   $30 to $600 over 151 levels
// ============================================================
// Deterministic jitter so gaps feel natural, not uniform
function jitter(level) {
    const x = Math.sin(level * 127.1 + 311.7) * 43758.5453;
    return x - Math.floor(x);
}

function rawProfit(level) {
    if (level <= 1) return 0;
    return 25000 * Math.pow((level - 1) / 150, 2.3);
}

// Compute all levels with varied gaps
const LEVELS = [];
let prevProfit = 0;

for (let i = 0; i < 151; i++) {
    const level = i + 1;
    const p = POKEMON[i];
    let profit;

    if (level === 1) { profit = 0; }
    else if (level === 151) { profit = 30000; }
    else {
        const raw = rawProfit(level);
        const baseGap = raw - rawProfit(level - 1);
        const minBase = prevProfit < 50 ? 3 : prevProfit < 200 ? 8 : prevProfit < 500 ? 15 : prevProfit < 1000 ? 25 : prevProfit < 3000 ? 40 : prevProfit < 7000 ? 80 : prevProfit < 15000 ? 120 : 180;
        const j = 0.6 + 0.8 * jitter(level);
        let gap = Math.max(baseGap, minBase) * j;
        if (gap < 10) gap = Math.round(gap);
        else if (gap < 30) gap = Math.round(gap / 2) * 2;
        else if (gap < 100) gap = Math.round(gap / 5) * 5;
        else if (gap < 300) gap = Math.round(gap / 10) * 10;
        else gap = Math.round(gap / 25) * 25;
        if (gap < 2) gap = 2;
        profit = prevProfit + gap;
    }

    const gap = i === 0 ? null : profit - LEVELS[i - 1].profit;

    LEVELS.push({
        level: level,
        id: p[0],
        name: p[1],
        type: p[2],
        evoFrom: p[3],
        evoLabel: evoLabel(p[0], p[1], p[2], p[3]),
        profit: profit,
        gap: gap
    });

    prevProfit = profit;
}

// Scale last ~20 levels to land on $25,000 for Mewtwo, then Mew = $30,000
const adjStart = 131;
const startVal = LEVELS[adjStart - 1].profit;
const rawEnd = LEVELS[149].profit;
const span = rawEnd - startVal;
if (span > 0) {
    for (let k = adjStart; k < 150; k++) {
        const frac = (LEVELS[k].profit - startVal) / span;
        LEVELS[k].profit = Math.round(startVal + frac * (25000 - startVal));
        LEVELS[k].gap = LEVELS[k].profit - LEVELS[k - 1].profit;
    }
}
LEVELS[150].profit = 30000;
LEVELS[150].gap = 30000 - LEVELS[149].profit;

// ============================================================
// PHASES
// ============================================================
const PHASES = [
    { title: 'Pallet Town', subtitle: 'Starter Pokemon', start: 1, end: 9,
      bg: 'https://archives.bulbagarden.net/media/upload/7/77/Pallet_Town_FRLG.png' },
    { title: 'Viridian to Pewter', subtitle: 'Early Routes', start: 10, end: 34,
      bg: 'https://archives.bulbagarden.net/media/upload/c/cf/Pewter_City_FRLG.png' },
    { title: 'Cerulean to Vermilion', subtitle: 'Gym Challenge', start: 35, end: 65,
      bg: 'https://archives.bulbagarden.net/media/upload/0/0b/Cerulean_City_FRLG.png' },
    { title: 'Celadon to Fuchsia', subtitle: 'Building Power', start: 66, end: 99,
      bg: 'https://archives.bulbagarden.net/media/upload/e/ee/Celadon_City_FRLG.png' },
    { title: 'Cinnabar Island', subtitle: 'Scaling Up', start: 100, end: 130,
      bg: 'https://archives.bulbagarden.net/media/upload/6/65/Cinnabar_Island_FRLG.png' },
    { title: 'Victory Road', subtitle: 'Elite Territory', start: 131, end: 143,
      bg: 'https://archives.bulbagarden.net/media/upload/b/b9/Kanto_Route_23_FRLG.png' },
    { title: 'Indigo Plateau', subtitle: 'Pokemon League', start: 144, end: 151,
      bg: 'https://archives.bulbagarden.net/media/upload/2/26/Indigo_Plateau_FRLG.png' }
];

// Format currency
function fmt(val) {
    if (val >= 1000) return '$' + val.toLocaleString();
    return '$' + val;
}

// ============================================================
// RENDER
// ============================================================
function render() {
    const guide = document.getElementById('guide');
    let html = '';

    PHASES.forEach((phase, pi) => {
        const phaseLevels = LEVELS.slice(phase.start - 1, phase.end);
        const minP = phaseLevels[0].profit;
        const maxP = phaseLevels[phaseLevels.length - 1].profit;
        const count = phaseLevels.length;

        html += '<div class="phase" id="phase-' + pi + '">';
        const bgStyle = phase.bg ? ' style="--bg-url: url(\'' + phase.bg + '\')"' : '';
        html += '<div class="phase-header" onclick="togglePhase(' + pi + ')"' + bgStyle + '>';
        html += '<span class="phase-title">' + phase.title + ' \u2014 ' + phase.subtitle +
                ' (' + fmt(minP) + ' \u2014 ' + fmt(maxP) + ')</span>';
        html += '<span class="phase-meta">';
        html += '<span class="phase-count">Lv ' + phase.start + '-' + phase.end + ' \u2022 ' + count + ' Pokemon</span>';
        html += '<span class="phase-toggle">\u25BC</span>';
        html += '</span></div>';
        html += '<div class="phase-body">';
        html += '<table><thead><tr>';
        html += '<th>Lv</th><th></th><th>Pokemon</th><th>Profit</th><th>Gap</th><th>Evolution</th>';
        html += '</tr></thead><tbody>';

        phaseLevels.forEach(lv => {
            html += '<tr id="row-' + lv.level + '">';
            html += '<td class="lv">' + lv.level + '</td>';
            html += '<td><img class="sprite" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/' + lv.id + '.png" loading="lazy"></td>';
            html += '<td class="pokemon-name">' + lv.name + '</td>';
            html += '<td class="profit">' + fmt(lv.profit) + '</td>';
            html += '<td class="gap">' + (lv.gap !== null ? '+' + fmt(lv.gap) : '\u2014') + '</td>';
            html += '<td class="evo-line">' + lv.evoLabel + '</td>';
            html += '</tr>';
        });

        html += '</tbody></table></div></div>';
    });

    guide.innerHTML = html;
}

// ============================================================
// INTERACTIVITY
// ============================================================
function togglePhase(idx) {
    document.getElementById('phase-' + idx).classList.toggle('collapsed');
}

function expandAll() {
    document.querySelectorAll('.phase').forEach(p => p.classList.remove('collapsed'));
}

function collapseAll() {
    document.querySelectorAll('.phase').forEach(p => p.classList.add('collapsed'));
}

// Level finder
function findLevel(pnl) {
    if (pnl < 0 || isNaN(pnl)) return null;
    let best = LEVELS[0];
    for (let i = 0; i < LEVELS.length; i++) {
        if (LEVELS[i].profit <= pnl) best = LEVELS[i];
        else break;
    }
    return best;
}

function updateFinder() {
    const input = document.getElementById('pnl-input');
    const result = document.getElementById('finder-result');
    const progress = document.getElementById('progress-fill');
    const val = parseInt(input.value) || 0;

    // Clear previous highlight
    document.querySelectorAll('tr.highlight').forEach(r => r.classList.remove('highlight'));

    if (val <= 0) {
        result.innerHTML = '';
        progress.style.width = '0%';
        return;
    }

    const lv = findLevel(val);
    if (!lv) return;

    result.innerHTML =
        '<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/' + lv.id + '.png">' +
        '<strong style="color:#f0e6cc">Lv ' + lv.level + ' ' + lv.name + '</strong>' +
        ' <span style="color:#8a7e6a">\u2022 ' + fmt(lv.profit) + ' P&L</span>';

    progress.style.width = Math.min(100, (val / 30000) * 100).toFixed(1) + '%';

    // Highlight and scroll to row
    const row = document.getElementById('row-' + lv.level);
    if (row) {
        row.classList.add('highlight');
        // Expand phase if collapsed
        const phase = row.closest('.phase');
        if (phase && phase.classList.contains('collapsed')) {
            phase.classList.remove('collapsed');
        }
        row.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}

document.getElementById('pnl-input').addEventListener('input', updateFinder);

// ============================================================
// INIT
// ============================================================
render();
</script>

</body>
</html>
